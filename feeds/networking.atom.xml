<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Ben Cardy - Networking</title><link href="/" rel="alternate"></link><link href="/feeds/networking.atom.xml" rel="self"></link><id>/</id><updated>2019-11-16T00:00:00+00:00</updated><entry><title>Junos commit history: who did what?</title><link href="/2019/11/16/junos-commit-history-who-did-what/" rel="alternate"></link><published>2019-11-16T00:00:00+00:00</published><updated>2019-11-16T00:00:00+00:00</updated><author><name>Ben Cardy</name></author><id>tag:None,2019-11-16:/2019/11/16/junos-commit-history-who-did-what/</id><summary type="html">&lt;p&gt;Junos has always had one fantastic advantage over Cisco's IOS: the ability to stage a pending commit, and see a history of changes, rather than each command immediately being executed on the running config a soon as you hit Enter. &lt;/p&gt;
&lt;p&gt;The &lt;code&gt;show | compare rollback X&lt;/code&gt; command has always been able …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Junos has always had one fantastic advantage over Cisco's IOS: the ability to stage a pending commit, and see a history of changes, rather than each command immediately being executed on the running config a soon as you hit Enter. &lt;/p&gt;
&lt;p&gt;The &lt;code&gt;show | compare rollback X&lt;/code&gt; command has always been able to show you the difference between your current config and what the config was like &lt;em&gt;X&lt;/em&gt; commits ago. However, I've always found it difficult to figure out what exactly was done in a single commit (or batch of commits) if they weren't the most recent. That is, until I learnt of this command: &lt;code&gt;show system rollback compare X Y&lt;/code&gt;! This lets you see the changes that were introduced just between the &lt;em&gt;X&lt;/em&gt; and &lt;em&gt;Y&lt;/em&gt; commits. &lt;/p&gt;
&lt;p&gt;Here's a real life example. Below is the commit history for a device at work. You can see there were a number of batches of commits going back in time where different individuals have done sole changes on the device:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ben@switch&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;show&lt;span class="w"&gt; &lt;/span&gt;system&lt;span class="w"&gt; &lt;/span&gt;commit
&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-11-13&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;15&lt;/span&gt;:06:51&lt;span class="w"&gt; &lt;/span&gt;GMT&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;katerina&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-11-13&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;14&lt;/span&gt;:49:19&lt;span class="w"&gt; &lt;/span&gt;GMT&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;katerina&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-11-13&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;14&lt;/span&gt;:43:01&lt;span class="w"&gt; &lt;/span&gt;GMT&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;katerina&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-11-13&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;14&lt;/span&gt;:42:11&lt;span class="w"&gt; &lt;/span&gt;GMT&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;katerina&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-11-13&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;14&lt;/span&gt;:41:01&lt;span class="w"&gt; &lt;/span&gt;GMT&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;katerina&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;5&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-11-13&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;14&lt;/span&gt;:03:53&lt;span class="w"&gt; &lt;/span&gt;GMT&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;katerina&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;6&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-11-13&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;12&lt;/span&gt;:28:33&lt;span class="w"&gt; &lt;/span&gt;GMT&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;katerina&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;7&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-11-13&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;12&lt;/span&gt;:25:44&lt;span class="w"&gt; &lt;/span&gt;GMT&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;katerina&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;8&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-11-13&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;12&lt;/span&gt;:24:53&lt;span class="w"&gt; &lt;/span&gt;GMT&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;katerina&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;9&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-11-13&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;12&lt;/span&gt;:23:28&lt;span class="w"&gt; &lt;/span&gt;GMT&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;katerina&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
…&lt;span class="w"&gt; &lt;/span&gt;output&lt;span class="w"&gt; &lt;/span&gt;truncated&lt;span class="w"&gt; &lt;/span&gt;…&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-09-13&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;14&lt;/span&gt;:16:43&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;ben&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;21&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-09-13&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;14&lt;/span&gt;:15:27&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;ben&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;22&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-09-13&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;14&lt;/span&gt;:13:48&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;ben&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;23&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-09-13&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;14&lt;/span&gt;:13:06&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;ben&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;24&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-09-13&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;14&lt;/span&gt;:08:43&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;ben&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;25&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-09-13&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;14&lt;/span&gt;:08:13&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;ben&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;26&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-09-13&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;14&lt;/span&gt;:06:50&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;ben&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-09-13&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;14&lt;/span&gt;:06:12&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;ben&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;28&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-08-07&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;14&lt;/span&gt;:21:33&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;stuart&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;29&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-08-07&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;14&lt;/span&gt;:21:08&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;stuart&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;30&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-08-07&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;14&lt;/span&gt;:18:43&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;stuart&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;31&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-08-05&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;09&lt;/span&gt;:06:28&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;stuart&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;32&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-06-19&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;13&lt;/span&gt;:04:54&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;lewis&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;33&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-06-19&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;13&lt;/span&gt;:02:34&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;lewis&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;34&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-06-19&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;13&lt;/span&gt;:01:31&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;lewis&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli&lt;span class="w"&gt; &lt;/span&gt;commit&lt;span class="w"&gt; &lt;/span&gt;confirmed,&lt;span class="w"&gt; &lt;/span&gt;rollback&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;3mins
&lt;span class="m"&gt;35&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-06-19&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;12&lt;/span&gt;:59:30&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;lewis&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;36&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-06-19&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;12&lt;/span&gt;:58:39&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;lewis&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;37&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-06-19&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;12&lt;/span&gt;:58:03&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;lewis&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli&lt;span class="w"&gt; &lt;/span&gt;commit&lt;span class="w"&gt; &lt;/span&gt;confirmed,&lt;span class="w"&gt; &lt;/span&gt;rollback&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;3mins
&lt;span class="m"&gt;38&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-06-07&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;13&lt;/span&gt;:58:39&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;bart&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;39&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-06-07&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;13&lt;/span&gt;:07:17&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;bart&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli&lt;span class="w"&gt; &lt;/span&gt;commit&lt;span class="w"&gt; &lt;/span&gt;confirmed,&lt;span class="w"&gt; &lt;/span&gt;rollback&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;1mins
&lt;span class="m"&gt;40&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-06-06&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;12&lt;/span&gt;:27:51&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;bart&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;41&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-05-15&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;13&lt;/span&gt;:07:07&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;chris&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;span class="m"&gt;42&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-05-09&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;14&lt;/span&gt;:14:43&lt;span class="w"&gt; &lt;/span&gt;BST&lt;span class="w"&gt; &lt;/span&gt;by&lt;span class="w"&gt; &lt;/span&gt;chris&lt;span class="w"&gt; &lt;/span&gt;via&lt;span class="w"&gt; &lt;/span&gt;cli
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;I needed to find what Stuart and Lewis had each introduced in their batches of changes back in August and June, respectively. This new command makes that trivially easy. &lt;/p&gt;
&lt;p&gt;Stuart's batches of changes were in commits 28–31. Running the following command, I was able to easily extract just what those commits introduced:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ben@switch&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;show&lt;span class="w"&gt; &lt;/span&gt;system&lt;span class="w"&gt; &lt;/span&gt;rollback&lt;span class="w"&gt; &lt;/span&gt;compare&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;32&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;28&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt;edit&lt;span class="w"&gt; &lt;/span&gt;interfaces&lt;span class="w"&gt; &lt;/span&gt;interface-range&lt;span class="w"&gt; &lt;/span&gt;ir_stp_edge&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="w"&gt;     &lt;/span&gt;member&lt;span class="w"&gt; &lt;/span&gt;ge-0/0/10&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;...&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;}&lt;/span&gt;
+&lt;span class="w"&gt;    &lt;/span&gt;member&lt;span class="w"&gt; &lt;/span&gt;ge-0/0/6&lt;span class="p"&gt;;&lt;/span&gt;
+&lt;span class="w"&gt;    &lt;/span&gt;member&lt;span class="w"&gt; &lt;/span&gt;ge-0/0/7&lt;span class="p"&gt;;&lt;/span&gt;
+&lt;span class="w"&gt;    &lt;/span&gt;member&lt;span class="w"&gt; &lt;/span&gt;ge-0/0/8&lt;span class="p"&gt;;&lt;/span&gt;
…&lt;span class="w"&gt; &lt;/span&gt;more&lt;span class="w"&gt; &lt;/span&gt;changes&lt;span class="w"&gt; &lt;/span&gt;…
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Note that you need to put the higher (older) commit number first, followed by the lower (more recent). Additionally, you need to increase the higher commits number by one, as you want to know what was introduced between those commits, &lt;em&gt;including the oldest one&lt;/em&gt;. &lt;/p&gt;
&lt;p&gt;Likewise, to see what Lewis introduced in his commits, we can run the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ben@switch&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;show&lt;span class="w"&gt; &lt;/span&gt;system&lt;span class="w"&gt; &lt;/span&gt;rollback&lt;span class="w"&gt; &lt;/span&gt;compare&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;38&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;32&lt;/span&gt;
…&lt;span class="w"&gt; &lt;/span&gt;some&lt;span class="w"&gt; &lt;/span&gt;changes&lt;span class="w"&gt; &lt;/span&gt;...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This will definitely save me some time in future!&lt;/p&gt;</content><category term="Networking"></category><category term="Junos"></category></entry><entry><title>The Two-Napkin Protocol</title><link href="/2019/07/07/the-two-napkin-protocol/" rel="alternate"></link><published>2019-07-07T00:00:00+01:00</published><updated>2019-07-07T00:00:00+01:00</updated><author><name>Ben Cardy</name></author><id>tag:None,2019-07-07:/2019/07/07/the-two-napkin-protocol/</id><summary type="html">&lt;p&gt;An interesting piece of history I didn't previously know.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;It was 1989. Kirk Lougheed of Cisco and Yakov Rekhter of IBM were having lunch in a meeting hall cafeteria at an Internet Engineering Task Force (IETF) conference.&lt;/p&gt;
&lt;p&gt;They wrote a new routing protocol that became RFC (Request for Comment) 1105 …&lt;/p&gt;&lt;/blockquote&gt;</summary><content type="html">&lt;p&gt;An interesting piece of history I didn't previously know.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;It was 1989. Kirk Lougheed of Cisco and Yakov Rekhter of IBM were having lunch in a meeting hall cafeteria at an Internet Engineering Task Force (IETF) conference.&lt;/p&gt;
&lt;p&gt;They wrote a new routing protocol that became RFC (Request for Comment) 1105, the &lt;a href="//tools.ietf.org/html/rfc1105"&gt;Border Gateway Protocol (BGP)&lt;/a&gt;, known to many as the “Two Napkin Protocol” — in reference to the napkins they used to capture their thoughts.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The post is worth a read just to see the photos of the napkins. I've never really thought before about how RFCs come to be. I'd always assumed they were the result of clever people in offices, not really thought up on the back of a napkin over drinks!&lt;/p&gt;
&lt;p&gt;Also, as it's 2019... happy 30th birthday, BGP (and the World Wide Web). &lt;/p&gt;</content><category term="Networking"></category><category term="BGP"></category></entry><entry><title>The Infrastructure Mess Causing Countless Internet Outages</title><link href="/2019/06/29/the-infrastructure-mess-causing-countless-internet-outages/" rel="alternate"></link><published>2019-06-29T00:00:00+01:00</published><updated>2019-06-29T00:00:00+01:00</updated><author><name>Ben Cardy</name></author><id>tag:None,2019-06-29:/2019/06/29/the-infrastructure-mess-causing-countless-internet-outages/</id><summary type="html">&lt;p&gt;Roland Dobbins from Netscout Arbor, quoted in this &lt;em&gt;Wired&lt;/em&gt; article:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;"Nonspecialists kind of view the internet as this high-tech, gleaming thing like the bridge of the starship Enterprise. It’s not like that at all. It’s more like an 18th-century Royal Navy frigate. There’s a lot of running …&lt;/p&gt;&lt;/blockquote&gt;</summary><content type="html">&lt;p&gt;Roland Dobbins from Netscout Arbor, quoted in this &lt;em&gt;Wired&lt;/em&gt; article:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;"Nonspecialists kind of view the internet as this high-tech, gleaming thing like the bridge of the starship Enterprise. It’s not like that at all. It’s more like an 18th-century Royal Navy frigate. There’s a lot of running around and screaming and shouting and pulling on ropes to try to get things going in the right direction."&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;It's amazing how fragile some of the technologies that power something the world takes for granted are; BGP is a great example of that. The Internet is everywhere, and it's becoming increasingly more necessary to be connected in order to be able to just go about our lives.&lt;/p&gt;
&lt;p&gt;Regarding the choice of headline, however, I don't think the word "mess" is fair. That does a disservice to the hundreds of very talented people that design, implement, and maintain the infrastructre that underpins our connected world. &lt;/p&gt;</content><category term="Networking"></category><category term="BGP"></category></entry><entry><title>Junos: Confirm a commit cleanly"</title><link href="/2018/07/27/junos-confirm-a-commit-cleanly/" rel="alternate"></link><published>2018-07-27T00:00:00+01:00</published><updated>2018-07-27T00:00:00+01:00</updated><author><name>Ben Cardy</name></author><id>tag:None,2018-07-27:/2018/07/27/junos-confirm-a-commit-cleanly/</id><summary type="html">&lt;p&gt;For years, I have loved the fact that Junos allows you to perform a &lt;code&gt;commit confirmed&lt;/code&gt; to apply the configuration with an automatic rollback in a certain number of minutes.&lt;/p&gt;
&lt;p&gt;I have always believed that the only way to confirm the commit (i.e. stop the automatic rollback) was to …&lt;/p&gt;</summary><content type="html">&lt;p&gt;For years, I have loved the fact that Junos allows you to perform a &lt;code&gt;commit confirmed&lt;/code&gt; to apply the configuration with an automatic rollback in a certain number of minutes.&lt;/p&gt;
&lt;p&gt;I have always believed that the only way to confirm the commit (i.e. stop the automatic rollback) was to &lt;code&gt;commit&lt;/code&gt; again. This creates two commits in the commit history, one containing the actual config diff, and an empty one purely used to stop the rollback. I've always thought that this creates a somewhat messy commit history, and confuses the use of &lt;code&gt;show | compare rollback&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;{% highlight bash %}
[edit]
ben@device&amp;gt; run show system commit
0   2018-07-27 08:44:26 BST by ben via cli
1   2018-07-27 08:44:07 BST by ben via cli commit confirmed, rollback in 5mins
2   2018-07-23 10:04:29 BST by ben via cli
3   2018-07-23 10:03:58 BST by ben via cli commit confirmed, rollback in 2mins&lt;/p&gt;
&lt;p&gt;[edit]
ben@device&amp;gt; show | compare rollback 1&lt;/p&gt;
&lt;p&gt;[edit]
ben@device&amp;gt; # Huh, it's empty?! I'm sure I did some work...&lt;/p&gt;
&lt;p&gt;[edit]
ben@device&amp;gt; show | compare rollback 2
[edit system]
-   host-name old-device
+   host-name device&lt;/p&gt;
&lt;p _="%" endhighlight&gt;[edit]
ben@device&amp;gt; # Oh, there it is...&lt;/p&gt;
&lt;p&gt;However, today I learnt that a &lt;code&gt;commit check&lt;/code&gt; is enough to stop the rollback, and doesn't create an empty commit! My commit histories are now much cleaner, and &lt;code&gt;show | compare rollback&lt;/code&gt; commands a lot easier to work out what you're actually looking at.&lt;/p&gt;
&lt;p&gt;{% highlight bash %}
[edit]
ben@device&amp;gt; run show system commit
1   2018-07-27 08:44:07 BST by ben via cli commit confirmed, rollback in 5mins
3   2018-07-23 10:03:58 BST by ben via cli commit confirmed, rollback in 2mins&lt;/p&gt;
&lt;p _="%" endhighlight&gt;[edit]
ben@device&amp;gt; show | compare rollback 1
[edit system]
-   host-name old-device
+   host-name device&lt;/p&gt;
&lt;p&gt;Much better!&lt;/p&gt;</content><category term="Networking"></category><category term="Junos"></category></entry><entry><title>Lessons Learnt from an Outage</title><link href="/2018/07/22/lessons-learnt-from-an-outage/" rel="alternate"></link><published>2018-07-22T00:00:00+01:00</published><updated>2018-07-22T00:00:00+01:00</updated><author><name>Ben Cardy</name></author><id>tag:None,2018-07-22:/2018/07/22/lessons-learnt-from-an-outage/</id><summary type="html">&lt;p&gt;I caused an outage last week. &lt;/p&gt;
&lt;p&gt;Not intentionally, and not a large outage by any stretch of the imagination. But it had various knock-on consequences that led to a lengthy application recovery time, long after full network connectivity was restored.&lt;/p&gt;
&lt;p&gt;We were replacing one of the two core MPLS routers …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I caused an outage last week. &lt;/p&gt;
&lt;p&gt;Not intentionally, and not a large outage by any stretch of the imagination. But it had various knock-on consequences that led to a lengthy application recovery time, long after full network connectivity was restored.&lt;/p&gt;
&lt;p&gt;We were replacing one of the two core MPLS routers at one of the three primary sites in our network. Upgrading the hardware to a newer model required costing the existing node out, powering it off, physically replacing it with the new hardware, and bringing the node back online.&lt;/p&gt;
&lt;p&gt;(For those of you interested in the details, we were upgrading a Juniper MX480 to an MX10003 - all logical connectivity was staying the same, but some links were being upgraded from 10Gbps to either 40 or 100).&lt;/p&gt;
&lt;p&gt;In preparation for the upgrade, I had taken the running config from the existing node, adapted what was necessary for the newer hardware (mainly interface name changes, etc) and preloaded it onto the new node waiting in the lab. So far so good.&lt;/p&gt;
&lt;p&gt;Unfortunately, the running config at the time I took it from the live node, was exactly that - the &lt;em&gt;live&lt;/em&gt; node. At that moment, it wasn't in its costed-out state, meaning that the minute we started repatching links into the new hardware, they were coming back live.&lt;/p&gt;
&lt;p&gt;These core node provide connectivity between our three primary sites, and their three data centres. As the links came up live, the new node started drawing traffic from the local data centre fabric before it had any connectivity to the other sites (or even the other node in the same site). This meant that for a period of around four minutes, between one sixth and one half of all egress traffic from the local data centre was being blackholed, and dropped.&lt;/p&gt;
&lt;p&gt;This caused connectivity issues between our ceph clusters, which then struggled to make sense of the situation, and filled up the only remaining link between this site and the others with traffic. (I don't know the full details of why it did this, or what that traffic was - I'm a network engineer, and not responsible for the rest of the infrastructure. But remember I said we were upgrading from 10 to 100Gbps on some links? This is partly why). This then exacerbated the connectivity problems (for other applications in addition to ceph), pinning the links at line rate long after the we had costed out the new node as originally intended, leading to the long recovery time for the application layer.&lt;/p&gt;
&lt;p&gt;So what did I learn from this outage? That's the most important question when something like this happens - particularly if it was your fault. This is what I learnt.&lt;/p&gt;
&lt;h3&gt;Don't become complacent&lt;/h3&gt;
&lt;p&gt;We had done this exact procedure for the other node in this site just days before, and all had gone smoothly (I had remembered to cost out the new node as I was preparing its config, instead of running with the live config from the existing node). Even if you've done an identical change before, &lt;em&gt;always&lt;/em&gt; triple check what you're doing if it has the potential to cause an impact on other parts of the business. Ideally, ask a colleague if they can spot anything you may have forgotten.&lt;/p&gt;
&lt;h3&gt;Unconditional summarisation isn't always a good thing&lt;/h3&gt;
&lt;p&gt;Even though the links weren't costed out, if all the core did was pass on routes learnt from the other sites, then the new node wouldn't have started drawing traffic until it was able to route it.§&lt;/p&gt;
&lt;p&gt;Instead, our core currently advertises three aggregate routes to its clients - the three private &lt;a href="https://tools.ietf.org/html/rfc1918"&gt;RFC1918&lt;/a&gt; ranges. These aggregates are active if just a single contributing route is present in the routing table. In our case, the core node's loopback is a perfectly valid contributing route to the 10.0.0.0/8 aggregate, causing it to be advertised even if every other link on the box was down, drawing (and dropping) traffic.&lt;/p&gt;
&lt;p&gt;Under normal circumstances, we'd obviously expect the core nodes to have full reachability to the rest of the core, and this wouldn't be an issue. However, certain failure scenarios can cause a node to become isolated (not just configuration mistakes like this one!) and blackhole traffic. Advertising more specific routes actually learnt from other peers, or some conditions imposed on the generation of the aggregate routes, would help limit this.&lt;/p&gt;
&lt;h3&gt;Be selective about the order links are repatched&lt;/h3&gt;
&lt;p&gt;Core-facing links first! The outage was caused by the fact that the links to the data centre fabric were connected before the core-facing links. If they had been done the other way around, and core connectivity as part of the MPLS domain was confirmed before connecting any client-facing links, the issue would have been avoided.&lt;/p&gt;
&lt;p&gt;Core-facing links are more important than client-facing - most clients will have redundancy via other nodes, and even if they don't, until your core node has reachability to the rest of the core, it's useless to its clients anyway.&lt;/p&gt;
&lt;h3&gt;Don't neglect CoS&lt;/h3&gt;
&lt;p&gt;While not directly related to the outage itself, ceph filling the links with non-essential traffic (compared to, say, production web or database traffic) led to outages on other applications that could no longer communicate. Some quality of service markings and traffic shaping or policing would have a gone a long way to mitigating the impact, by restricting non-business-critical traffic to a subset of the link. Less important (but still useful) on the upgraded 100Gbps connections; but our single 10Gbps like couldn't cope.&lt;/p&gt;</content><category term="Networking"></category></entry></feed>